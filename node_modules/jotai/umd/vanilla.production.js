!function(n,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((n="undefined"!=typeof globalThis?globalThis:n||self).jotaiVanilla={})}(this,(function(n){"use strict";var r=0;function e(n){return n(this)}function t(n,r,e){return r(this,"function"==typeof e?e(n(this)):e)}function a(n,r){(null==r||r>n.length)&&(r=n.length);for(var e=0,t=Array(r);e<r;e++)t[e]=n[e];return t}function o(n,r){var e="undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(e)return(e=e.call(n)).next.bind(e);if(Array.isArray(n)||(e=function(n,r){if(n){if("string"==typeof n)return a(n,r);var e={}.toString.call(n).slice(8,-1);return"Object"===e&&n.constructor&&(e=n.constructor.name),"Map"===e||"Set"===e?Array.from(n):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?a(n,r):void 0}}(n))||r){e&&(n=e);var t=0;return function(){return t>=n.length?{done:!0}:{done:!1,value:n[t++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=function(n,r){return n.unstable_is?n.unstable_is(r):r===n},f=function(n){return"init"in n},l=function(n){return!!n.write},v=new WeakMap,c=function(n){var r;return d(n)&&!(null!=(r=v.get(n))&&r[1])},d=function(n){return"function"==typeof(null==n?void 0:n.then)},s=function(n){return"v"in n||"e"in n},y=function(n){if("e"in n)throw n.e;return n.v},p=function(n,r,e){e.p.has(n)||(e.p.add(n),r.then((function(){e.p.delete(n)}),(function(){e.p.delete(n)})))},h=function(n,r,e,t,a){var o;e.d.set(t,a.n),c(e.v)&&p(r,e.v,a),null==(o=a.m)||o.t.add(r),n&&g(n,t,r)},m=function(){return[new Map,new Map,new Set]},w=function(n,r,e){n[0].has(r)||n[0].set(r,new Set),n[1].set(r,e)},g=function(n,r,e){var t=n[0].get(r);t&&t.add(e)},b=function(n,r){n[2].add(r)},S=function(n){for(;n[1].size||n[2].size;){n[0].clear();var r=new Set(n[1].values());n[1].clear();var e=new Set(n[2]);n[2].clear(),r.forEach((function(n){var r;return null==(r=n.m)?void 0:r.l.forEach((function(n){return n()}))})),e.forEach((function(n){return n()}))}},A=function(){for(var n=arguments.length,r=new Array(n),e=0;e<n;e++)r[e]=arguments[e];var t=r[0],a=r[1],i=r[2],g=r[3],k=function(n,r,e){var a,i,u,f="v"in r,l=r.v,s=c(r.v)?r.v:null;if(d(e)){!function(n){if(!v.has(n)){var r=[new Set,!1];v.set(n,r);var e=function(){r[1]=!0};n.then(e,e),n.onCancel=function(n){r[0].add(n)}}}(e);for(var y,h=o(r.d.keys());!(y=h()).done;){var m=y.value;p(n,e,t(m))}r.v=e,delete r.e}else r.v=e,delete r.e;f&&Object.is(l,r.v)||(++r.n,s&&(a=s,i=e,(u=v.get(a))&&(u[1]=!0,u[0].forEach((function(n){return n(i)})))))},M=function(n,r,e){var o=t(r);if(s(o)){if(o.m&&(null==e||!e.has(r)))return o;if(Array.from(o.d).every((function(r){var t=r[0],a=r[1];return M(n,t,e).n===a})))return o}o.d.clear();var i,v,c=!0,p={get signal(){return i||(i=new AbortController),i.signal},get setSelf(){return!v&&l(r)&&(v=function(){if(!c){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return C.apply(void 0,[r].concat(e))}}),v}};try{var w=a(r,(function(a){if(u(r,a)){var i=t(a);if(!s(i)){if(!f(a))throw new Error("no atom init");k(a,i,a.init)}return y(i)}var l=M(n,a,e);if(c)h(n,r,o,a,l);else{var v=m();h(v,r,o,a,l),x(v,r,o),S(v)}return y(l)}),p);if(k(r,o,w),d(w)){null==w.onCancel||w.onCancel((function(){var n;return null==(n=i)?void 0:n.abort()}));var g=function(){if(o.m){var n=m();x(n,r,o),S(n)}};w.then(g,g)}return o}catch(n){return delete o.v,o.e=n,++o.n,o}finally{c=!1}},E=function(n,r,e){var a=[],i=new Set,u=function(r,e){if(!i.has(r)){i.add(r);for(var f,l=o(function(n,r,e){for(var a,i,u=new Map,f=o((null==(l=e.m)?void 0:l.t)||[]);!(i=f()).done;){var l,v=i.value;u.set(v,t(v))}for(var c,d=o(e.p);!(c=d()).done;){var s=c.value;u.set(s,t(s))}return null==(a=function(n,r){return n[0].get(r)}(n,r))||a.forEach((function(n){u.set(n,t(n))})),u}(n,r,e));!(f=l()).done;){var v=f.value,c=v[0],d=v[1];r!==c&&u(c,d)}a.push([r,e,e.n])}};u(r,e);for(var f=new Set([r]),l=a.length-1;l>=0;--l){for(var v,c=a[l],d=c[0],s=c[1],y=c[2],p=!1,h=o(s.d.keys());!(v=h()).done;){var m=v.value;if(m!==d&&f.has(m)){p=!0;break}}p&&(M(n,d,i),x(n,d,s),y!==s.n&&(w(n,d,s),f.add(d))),i.delete(d)}},j=function(n,r){for(var e=arguments.length,a=new Array(e>2?e-2:0),o=2;o<e;o++)a[o-2]=arguments[o];var l=i.apply(void 0,[r,function(r){return y(M(n,r))},function(e){for(var a,o=t(e),i=arguments.length,l=new Array(i>1?i-1:0),v=1;v<i;v++)l[v-1]=arguments[v];if(u(r,e)){if(!f(e))throw new Error("atom not writable");var c="v"in o,d=o.v,s=l[0];k(e,o,s),x(n,e,o),c&&Object.is(d,o.v)||(w(n,e,o),E(n,e,o))}else a=j.apply(void 0,[n,e].concat(l));return S(n),a}].concat(a));return l},C=function(n){for(var r=m(),e=arguments.length,t=new Array(e>1?e-1:0),a=1;a<e;a++)t[a-1]=arguments[a];var o=j.apply(void 0,[r,n].concat(t));return S(r),o},x=function(n,r,e){if(e.m&&!c(e.v)){for(var a,i=o(e.d.keys());!(a=i()).done;){var u=a.value;if(!e.m.d.has(u))z(n,u,t(u)).t.add(r),e.m.d.add(u)}for(var f,l=o(e.m.d||[]);!(f=l()).done;){var v=f.value;if(!e.d.has(v)){e.m.d.delete(v);var d=I(n,v,t(v));null==d||d.t.delete(r)}}}},z=function(n,r,e){if(!e.m){M(n,r);for(var a,i=o(e.d.keys());!(a=i()).done;){var u=a.value;z(n,u,t(u)).t.add(r)}if(e.m={l:new Set,d:new Set(e.d.keys()),t:new Set},l(r)){var f=e.m;b(n,(function(){var e=g(r,(function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return j.apply(void 0,[n,r].concat(t))}));e&&(f.u=e)}))}}return e.m},I=function(n,r,e){if(!e.m||e.m.l.size||Array.from(e.m.t).some((function(n){var e;return null==(e=t(n).m)?void 0:e.d.has(r)})))return e.m;var a=e.m.u;a&&b(n,a),delete e.m;for(var i,u=o(e.d.keys());!(i=u()).done;){var f=i.value,l=I(n,f,t(f));null==l||l.t.delete(r)}},O={get:function(n){return y(M(void 0,n))},set:C,sub:function(n,r){var e=m(),a=t(n),o=z(e,n,a);S(e);var i=o.l;return i.add(r),function(){i.delete(r);var e=m();I(e,n,a),S(e)}},unstable_derive:function(n){return A.apply(void 0,n(t,a,i,g))}};return O},k=function(){var n=new WeakMap;return A((function(r){var e=n.get(r);return e||(e={d:new Map,p:new Set,n:0},n.set(r,e)),e}),(function(n){for(var r=arguments.length,e=new Array(r>1?r-1:0),t=1;t<r;t++)e[t-1]=arguments[t];return n.read.apply(n,e)}),(function(n){for(var r=arguments.length,e=new Array(r>1?r-1:0),t=1;t<r;t++)e[t-1]=arguments[t];return n.write.apply(n,e)}),(function(n){for(var r=arguments.length,e=new Array(r>1?r-1:0),t=1;t<r;t++)e[t-1]=arguments[t];return null==n.onMount?void 0:n.onMount.apply(n,e)}))};n.atom=function(n,a){var o="atom"+ ++r,i={toString:function(){return o}};return"function"==typeof n?i.read=n:(i.init=n,i.read=e,i.write=t),a&&(i.write=a),i},n.createStore=k,n.getDefaultStore=function(){return i||(i=k()),i}}));
